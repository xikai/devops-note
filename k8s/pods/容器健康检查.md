# ReadineeProbe探针
* 用于判断容器是否启动完成（ready状态）,让 kubelet 知道应用程序何时准备接受新流量。如果应用程序在进程启动后需要一些时间来初始化状态，要配置 readiness 探针让 Kubernetes 在发送新流量之前进行等待。
* 如果ReadinessProbe探针探测到失败，则Pod的状态将被修改。Endpoint Controller将从Service的Endpoint中删除包含该容器所在Pod的Eenpoint。

# LivenessProbe探针
* 用于判断容器是否存活（running状态），Kubelet 会定期地 ping liveness 探针，如果LivenessProbe探针探测到容器不健康，则kubelet将杀掉该容器，并根据容器的重启策略做相应处理。
* 若一个容器不包含LivenessProbe探针，kubelet认为该容器的LivenessProbe探针返回值是“Success”。
    * ExecAction：在容器内执行一个命令，若返回码为0，则表明容器健康。
    * TCPSocketAction：通过容器的IP地址和端口号执行TCP检查，若能建立TCP连接，则表明容器健康。
    * HTTPGetAction：通过容器的IP地址、端口号及路径调用HTTP Get方法，若响应的状态码大于等于200且小于400，则表明容器健康。

# startupProbe探针
* 启动检查机制，应用一些启动缓慢的业务，避免业务长时间启动而被上面两类探针kill掉。
* 如果是具有不可预测或可变启动时间的应用程序应使用 startup 探针。

# 探测方式
### HTTP (kubelet 将 HTTP GET 请求发送到 endpoint，并检查 2xx 或 3xx 响应)
```yml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
```
* HTTP 探针包含其他额外参数：
```
host：要连接的主机名（默认值：pod 的 IP）。
scheme：HTTP（默认）或 HTTPS。
path：HTTP/S 服务器上的路径 。
httpHeaders：自定义标头（如果需要标头用于身份验证、CORS 设置等） 。
port：访问服务器的端口名称或端口号。
```

### TCP (如果仅需要检查是否可以建立 TCP 连接，则可以指定 TCP 探针)
```yml
readinessProbe:
  tcpSocket:
    port: 21
```

### Command (将探针配置为运行 shell 命令。如果命令返回的退出代码为 0，则检查通过，否则 Pod 将被标记为不健康)
```yml
readinessProbe:
  exec:
    command: ["/bin/sh", "-ec", "vault status -tls-skip-verify"]

```

# 这三种探针均具有以下参数：
```
initialDelaySeconds：启动 liveness、readiness 探针前要等待的秒数。
periodSeconds：检查探针的频率。
timeoutSeconds：将探针标记为超时（未通过运行状况检查）之前的秒数。
successThreshold：探针需要通过的最小连续成功检查数量。
failureThreshold：将探针标记为失败之前的重试次数。对于 liveness 探针，这将导致 Pod 重新启动。对于 readiness 探针，将标记 Pod 为未就绪（unready）。
```
